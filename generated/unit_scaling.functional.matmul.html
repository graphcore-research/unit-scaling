<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>unit_scaling.functional.matmul &mdash; unit-scaling  documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/sphinx_highlight.js"></script>
        <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="unit_scaling.functional.residual_add" href="unit_scaling.functional.residual_add.html" />
    <link rel="prev" title="unit_scaling.functional.linear" href="unit_scaling.functional.linear.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            unit-scaling
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../user_guide.html">User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../development.html">Developer Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../limitations.html">Limitations</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../api_reference.html">API Reference</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="unit_scaling.html">unit_scaling</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="unit_scaling.GELU.html">unit_scaling.GELU</a></li>
<li class="toctree-l3"><a class="reference internal" href="unit_scaling.MHSA.html">unit_scaling.MHSA</a></li>
<li class="toctree-l3"><a class="reference internal" href="unit_scaling.MLP.html">unit_scaling.MLP</a></li>
<li class="toctree-l3"><a class="reference internal" href="unit_scaling.CrossEntropyLoss.html">unit_scaling.CrossEntropyLoss</a></li>
<li class="toctree-l3"><a class="reference internal" href="unit_scaling.Dropout.html">unit_scaling.Dropout</a></li>
<li class="toctree-l3"><a class="reference internal" href="unit_scaling.Embedding.html">unit_scaling.Embedding</a></li>
<li class="toctree-l3"><a class="reference internal" href="unit_scaling.LayerNorm.html">unit_scaling.LayerNorm</a></li>
<li class="toctree-l3"><a class="reference internal" href="unit_scaling.Linear.html">unit_scaling.Linear</a></li>
<li class="toctree-l3"><a class="reference internal" href="unit_scaling.Softmax.html">unit_scaling.Softmax</a></li>
<li class="toctree-l3"><a class="reference internal" href="unit_scaling.TransformerDecoder.html">unit_scaling.TransformerDecoder</a></li>
<li class="toctree-l3"><a class="reference internal" href="unit_scaling.TransformerLayer.html">unit_scaling.TransformerLayer</a></li>
<li class="toctree-l3"><a class="reference internal" href="unit_scaling.constraints.html">unit_scaling.constraints</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="unit_scaling.functional.html">unit_scaling.functional</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="unit_scaling.functional.cross_entropy.html">unit_scaling.functional.cross_entropy</a></li>
<li class="toctree-l4"><a class="reference internal" href="unit_scaling.functional.dropout.html">unit_scaling.functional.dropout</a></li>
<li class="toctree-l4"><a class="reference internal" href="unit_scaling.functional.embedding.html">unit_scaling.functional.embedding</a></li>
<li class="toctree-l4"><a class="reference internal" href="unit_scaling.functional.gelu.html">unit_scaling.functional.gelu</a></li>
<li class="toctree-l4"><a class="reference internal" href="unit_scaling.functional.layer_norm.html">unit_scaling.functional.layer_norm</a></li>
<li class="toctree-l4"><a class="reference internal" href="unit_scaling.functional.linear.html">unit_scaling.functional.linear</a></li>
<li class="toctree-l4 current"><a class="current reference internal" href="#">unit_scaling.functional.matmul</a></li>
<li class="toctree-l4"><a class="reference internal" href="unit_scaling.functional.residual_add.html">unit_scaling.functional.residual_add</a></li>
<li class="toctree-l4"><a class="reference internal" href="unit_scaling.functional.residual_split.html">unit_scaling.functional.residual_split</a></li>
<li class="toctree-l4"><a class="reference internal" href="unit_scaling.functional.scale_elementwise.html">unit_scaling.functional.scale_elementwise</a></li>
<li class="toctree-l4"><a class="reference internal" href="unit_scaling.functional.softmax.html">unit_scaling.functional.softmax</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="unit_scaling.scale.html">unit_scaling.scale</a></li>
<li class="toctree-l3"><a class="reference internal" href="unit_scaling.utils.html">unit_scaling.utils</a></li>
</ul>
</li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">unit-scaling</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../api_reference.html">API Reference</a></li>
          <li class="breadcrumb-item"><a href="unit_scaling.html">unit_scaling</a></li>
          <li class="breadcrumb-item"><a href="unit_scaling.functional.html">unit_scaling.functional</a></li>
      <li class="breadcrumb-item active">unit_scaling.functional.matmul</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/generated/unit_scaling.functional.matmul.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="unit-scaling-functional-matmul">
<h1>unit_scaling.functional.matmul<a class="headerlink" href="#unit-scaling-functional-matmul" title="Permalink to this heading"></a></h1>
<dl class="py function">
<dt class="sig sig-object py" id="unit_scaling.functional.matmul">
<span class="sig-prename descclassname"><span class="pre">unit_scaling.functional.</span></span><span class="sig-name descname"><span class="pre">matmul</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="pre">left:</span> <span class="pre">~torch.Tensor,</span> <span class="pre">right:</span> <span class="pre">~torch.Tensor,</span> <span class="pre">constraint:</span> <span class="pre">~typing.Optional[~typing.Callable[[float,</span> <span class="pre">float,</span> <span class="pre">float],</span> <span class="pre">~typing.Union[float,</span> <span class="pre">~typing.Tuple[float,</span> <span class="pre">float,</span> <span class="pre">float]]]]</span> <span class="pre">=</span> <span class="pre">&lt;function</span> <span class="pre">gmean&gt;</span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Tensor</span></span></span><a class="reference internal" href="../_modules/unit_scaling/functional.html#matmul"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#unit_scaling.functional.matmul" title="Permalink to this definition"></a></dt>
<dd><p>A <strong>unit-scaled</strong> matrix product of two tensors.</p>
<p>Matrix product of two tensors.</p>
<p>The behavior depends on the dimensionality of the tensors as follows:</p>
<ul>
<li><p>If both tensors are 1-dimensional, the dot product (scalar) is returned.</p></li>
<li><p>If both arguments are 2-dimensional, the matrix-matrix product is returned.</p></li>
<li><p>If the first argument is 1-dimensional and the second argument is 2-dimensional,
a 1 is prepended to its dimension for the purpose of the matrix multiply.
After the matrix multiply, the prepended dimension is removed.</p></li>
<li><p>If the first argument is 2-dimensional and the second argument is 1-dimensional,
the matrix-vector product is returned.</p></li>
<li><p>If both arguments are at least 1-dimensional and at least one argument is
N-dimensional (where N &gt; 2), then a batched matrix multiply is returned.  If the first
argument is 1-dimensional, a 1 is prepended to its dimension for the purpose of the
batched matrix multiply and removed after.  If the second argument is 1-dimensional, a
1 is appended to its dimension for the purpose of the batched matrix multiple and removed after.
The non-matrix (i.e. batch) dimensions are <span class="xref std std-ref">broadcasted</span> (and thus
must be broadcastable).  For example, if <code class="xref py py-attr docutils literal notranslate"><span class="pre">input</span></code> is a
<span class="math notranslate nohighlight">\((j \times 1 \times n \times n)\)</span> tensor and <code class="xref py py-attr docutils literal notranslate"><span class="pre">other</span></code> is a <span class="math notranslate nohighlight">\((k \times n \times n)\)</span>
tensor, <code class="xref py py-attr docutils literal notranslate"><span class="pre">out</span></code> will be a <span class="math notranslate nohighlight">\((j \times k \times n \times n)\)</span> tensor.</p>
<p>Note that the broadcasting logic only looks at the batch dimensions when determining if the inputs
are broadcastable, and not the matrix dimensions. For example, if <code class="xref py py-attr docutils literal notranslate"><span class="pre">input</span></code> is a
<span class="math notranslate nohighlight">\((j \times 1 \times n \times m)\)</span> tensor and <code class="xref py py-attr docutils literal notranslate"><span class="pre">other</span></code> is a <span class="math notranslate nohighlight">\((k \times m \times p)\)</span>
tensor, these inputs are valid for broadcasting even though the final two dimensions (i.e. the
matrix dimensions) are different. <code class="xref py py-attr docutils literal notranslate"><span class="pre">out</span></code> will be a <span class="math notranslate nohighlight">\((j \times k \times n \times p)\)</span> tensor.</p>
</li>
</ul>
<p>This operation has support for arguments with <span class="xref std std-ref">sparse layouts</span>. In particular the
matrix-matrix (both arguments 2-dimensional) supports sparse arguments with the same restrictions
as <code class="xref py py-func docutils literal notranslate"><span class="pre">torch.mm()</span></code></p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Sparse support is a beta feature and some layout(s)/dtype/device combinations may not be supported,
or may not have autograd support. If you notice missing functionality please
open a feature request.</p>
</div>
<p>This operator supports <span class="xref std std-ref">TensorFloat32</span>.</p>
<p>On certain ROCm devices, when using float16 inputs this module will use <span class="xref std std-ref">different precision</span> for backward.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The 1-dimensional dot product version of this function does not support an <code class="xref py py-attr docutils literal notranslate"><span class="pre">out</span></code> parameter.</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>input</strong> (<em>Tensor</em>) – the first tensor to be multiplied</p></li>
<li><p><strong>other</strong> (<em>Tensor</em>) – the second tensor to be multiplied</p></li>
<li><p><strong>constraint</strong> (<em>Optional</em><em>[</em><em>Callable</em><em>[</em><em>[</em><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.11)"><em>float</em></a><em>, </em><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.11)"><em>float</em></a><em>, </em><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.11)"><em>float</em></a><em>]</em><em>, </em><em>Union</em><em>[</em><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.11)"><em>float</em></a><em>, </em><em>Tuple</em><em>[</em><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.11)"><em>float</em></a><em>, </em><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.11)"><em>float</em></a><em>, </em><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.11)"><em>float</em></a><em>]</em><em>]</em><em>]</em><em>]</em><em>?</em>) – function  which takes <cite>output_scale</cite>,`left_grad_scale` &amp; <cite>right_grad_scale</cite> (in that order) and returns either a) a single ‘constrained’ scale (often necessary for valid gradients), or b) atuple of three output scales in the same order of the input scales (it is expectedthat two or all of these scales are constrained to be the same). If <cite>None</cite> isprovided, no constraint will be applied. Defaults to <cite>gmean</cite>.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="unit_scaling.functional.linear.html" class="btn btn-neutral float-left" title="unit_scaling.functional.linear" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="unit_scaling.functional.residual_add.html" class="btn btn-neutral float-right" title="unit_scaling.functional.residual_add" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright (c) 2023 Graphcore Ltd. All rights reserved.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>